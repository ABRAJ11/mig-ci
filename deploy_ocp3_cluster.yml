# - hosts: localhost
#   roles:
#     - ocp3_aws_deploy
#   vars_files:
#     - "{{ playbook_dir }}/config/defaults.yml"

# # AWS group is created in previous role
# - hosts: aws
#   roles:
#     - ocp3_aws_provision
#   vars_files:
#     - "{{ playbook_dir }}/config/defaults.yml"
#   become: true

- hosts: localhost
  tasks:
    - name: Get AWS EC2 instance ip
      include_role:
        name: ec2_provision
        tasks_from: get_ip
      vars:
        instance_name: "{{ aws_name_suffix }}"

    - name: Login to cluster
      include_role:
        name: login_ocp
      vars:
        force_login: true
        target_kubeconfig: "{{ ocp3_kubeconfig }}"
        console_addr: "https://{{ ec2_instance_ip }}.xip.io:8443"
  vars_files:
    - "{{ playbook_dir }}/config/defaults.yml"
    - "{{ playbook_dir }}/roles/ocp3_aws_deploy/defaults/main.yml"
